<div class="container py-5">
  <div class="content-box p-4">
    <section class="text-center mb-4">
      <h1 class="display-4 fw-bold text-gradient">Librería</h1>
      <button class="btn btn-primary btn-lg shadow-lg" (click)="abrirNuevoLibro()">Añadir Libro</button>
    </section>


    <div class="row g-4" *ngIf="!loading">
      <div class="col-12" *ngFor="let book of books">
        <div class="book-card">
          <!-- Imagen de la portada -->
          <div class="book-image">
            <img [src]="'https://dguerrero.helioho.st/covers/' + book.cover" alt="{{ book.title }}" />
          </div>

          <!-- Información del libro -->
          <div class="book-info">
            <h4>{{ book.title }}</h4>
            <p class="text-muted">{{ book.author }}</p>

            <!-- Estado -->
            <span class="badge" [ngClass]="{
              'badge-completed': book.status === 'Completado',
              'badge-reading': book.status === 'En progreso',
              'badge-not-started': book.status === 'No iniciado'
            }">{{ book.status }}</span>

            <!-- Puntuación -->
            <div class="mt-3 rating">
              <!-- Estrellas llenas -->
              <ng-container *ngFor="let _ of [].constructor(getFullStars(book.rating))">
                <i class="bi bi-star-fill text-warning"></i>
              </ng-container>

              <!-- Estrella parcial (¼, ½ o ¾) si aplica -->
              <ng-container *ngIf="getFractionalStar(book.rating)">
                <i class="{{ getFractionalStar(book.rating) }} text-warning"></i>
              </ng-container>

              <!-- Estrellas vacías -->
              <ng-container *ngFor="let _ of [].constructor(getEmptyStars(book.rating))">
                <i class="bi bi-star text-muted"></i>
              </ng-container>
            </div>


            <!-- Barra de progreso con porcentaje -->
            <div class="progress mt-3">
              <div class="progress-bar" role="progressbar" [style.width.%]="(book.progress / book.pages) * 100"
                [attr.aria-valuenow]="(book.progress / book.pages) * 100" aria-valuemin="0" aria-valuemax="100">
                {{ ((book.progress / book.pages) * 100) | number:'1.0-0' }}%
              </div>
            </div>

            <!-- Botones de Acción -->
            <div class="actions">
              <button class="btn-action btn-edit">
                <i class="bi bi-pencil"></i> Editar
              </button>
              <button class="btn-action btn-delete">
                <i class="bi bi-trash"></i> Eliminar
              </button>
            </div>

          </div>
        </div>
      </div>
    </div>
    <!-- Contenedor de carga -->
    <div *ngIf="loading" class="row g-4 loading-container">
      <div class="spinner"></div>
      <p>Cargando información...</p>
    </div>

  </div>
</div>

<app-nuevo-libro *ngIf="estaNuevoLibroAbierto" (libroCreado)="cerrarNuevoLibro()"></app-nuevo-libro>